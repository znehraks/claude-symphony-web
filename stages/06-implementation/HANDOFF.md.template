# Stage Handoff: 06-implementation → 07-refactoring

**Created**: {{TIMESTAMP}}
**Creator**: ClaudeCode
**Duration**: {{DURATION}}

---

## AI Usage Log

> This section compares intended AI settings with actual usage to track collaboration efficiency.

### Intended vs Actual Comparison

| Item | Intended | Actual | Match |
|------|----------|--------|-------|
| Primary AI | ClaudeCode | {{ACTUAL_PRIMARY_AI}} | {{PRIMARY_MATCH}} |
| Secondary AI | - | {{ACTUAL_SECONDARY_AI}} | - |
| Collaboration Mode | none (single AI) | {{ACTUAL_COLLABORATION_MODE}} | {{MODE_MATCH}} |
| External AI Call | No | {{ACTUAL_EXTERNAL_CALL}} | {{EXTERNAL_MATCH}} |

### AI Call Log

| AI | Call Time | Role | Prompt | Result | Status |
|----|-----------|------|--------|--------|--------|
| {{AI_1}} | {{TIME_1}} | {{ROLE_1}} | {{PROMPT_1}} | {{OUTPUT_1}} | {{STATUS_1}} |
| {{AI_2}} | {{TIME_2}} | {{ROLE_2}} | {{PROMPT_2}} | {{OUTPUT_2}} | {{STATUS_2}} |

### Fallback Log

| Attempted AI | Failure Time | Error | Fallback AI | Result |
|--------------|--------------|-------|-------------|--------|
| {{FALLBACK_ATTEMPTED}} | {{FALLBACK_TIME}} | {{FALLBACK_ERROR}} | {{FALLBACK_TO}} | {{FALLBACK_RESULT}} |

> Configuration: `config/ai_collaboration.yaml`, `config/mcp_fallbacks.yaml`

---

## Completed Tasks

- [ ] Project scaffolding
- [ ] Common components ({{COMPONENT_COUNT}} components)
- [ ] Core feature implementation
- [ ] API endpoints ({{API_COUNT}} endpoints)
- [ ] **Smoke test execution** (Test-First)
- [ ] Checkpoint creation
- [ ] HANDOFF.md generation

---

## Test Status (Test-First Flow)

> ⚠️ **Required**: Run smoke tests after implementation completion for early bug detection.

### Tests Run

| Test Type | Run Time | Result | Notes |
|-----------|----------|--------|-------|
| `npm run dev` | {{DEV_TIME}} | {{DEV_RESULT}} | Dev server execution |
| ESLint | {{LINT_TIME}} | {{LINT_RESULT}} | Static analysis |
| TypeScript | {{TS_TIME}} | {{TS_RESULT}} | Type check |
| Playwright smoke | {{PLAYWRIGHT_TIME}} | {{PLAYWRIGHT_RESULT}} | UI basic functionality |

### Bugs Found

| ID | Description | Found At | Status | Fix File |
|----|-------------|----------|--------|----------|
| {{BUG_ID}} | {{BUG_DESC}} | {{BUG_FOUND}} | {{BUG_STATUS}} | {{BUG_FILE}} |

### Reason for Test Skip

- **If skipped**: {{TEST_SKIP_REASON}}
- **Recommended action**: Run basic tests before 07-refactoring

---

## Context for Next Agent

### Project Structure
```
source_code/
├── src/
│   ├── components/
│   ├── pages/
│   ├── api/
│   ├── lib/
│   └── styles/
├── package.json
└── ...
```

### Finalized Tech Stack

| Area | Technology | Version |
|------|------------|---------|
| Framework | {{FRAMEWORK}} | {{VERSION}} |
| UI Library | {{UI_LIB}} | |
| State | {{STATE_MGMT}} | |
| API | {{API_STYLE}} | |

### Completed Features

| Feature | Status | File | Test Status |
|---------|--------|------|-------------|
| {{FEATURE_1}} | Complete | {{FILE_1}} | {{TEST_1}} |
| {{FEATURE_2}} | Complete | {{FILE_2}} | {{TEST_2}} |
| {{FEATURE_3}} | Complete | {{FILE_3}} | {{TEST_3}} |

### Known Issues / Technical Debt
1. {{TECH_DEBT_1}}
2. {{TECH_DEBT_2}}

### Areas Needing Refactoring
- {{REFACTOR_AREA_1}}: {{REASON_1}}
- {{REFACTOR_AREA_2}}: {{REASON_2}}

---

## Checkpoint Information

| ID | Created | Description | Auto/Manual |
|----|---------|-------------|-------------|
| {{CP_ID}} | {{CP_DATE}} | Sprint 1 complete | {{CP_TYPE}} |

Recovery command:
```bash
scripts/restore-checkpoint.sh {{CP_ID}}
```

---

## Generated Outputs

| File | Description | Validation Status |
|------|-------------|-------------------|
| source_code/ | Implemented source code | {{CODE_VALIDATED}} |
| implementation_log.md | Implementation log | - |

---

## 07-refactoring Stage Guide

### Immediate Tasks
1. **Run regression tests** (Test-First)
2. Code quality analysis (ESLint, TypeScript)
3. Identify duplicate code
4. Analyze performance bottlenecks

### Refactoring Priorities
1. {{REFACTOR_PRIORITY_1}}
2. {{REFACTOR_PRIORITY_2}}
3. {{REFACTOR_PRIORITY_3}}

### Warnings
- ⚠️ **Codex CLI required** - Use `/codex` command for deep analysis
- Be careful not to break existing functionality
- Verify same behavior before/after refactoring
- Use checkpoints

---

## Metadata

```yaml
stage: "06-implementation"
status: "completed"
next_stage: "07-refactoring"
timestamp: "{{TIMESTAMP}}"

ai_usage:
  intended:
    primary: "claudecode"
    secondary: null
    collaboration_mode: "none"
  actual:
    primary: "{{ACTUAL_PRIMARY_AI}}"
    secondary: "{{ACTUAL_SECONDARY_AI}}"
    collaboration_mode: "{{ACTUAL_COLLABORATION_MODE}}"
  fallbacks: {{FALLBACK_COUNT}}
  match_rate: "{{MATCH_RATE}}"

testing:
  smoke_test_run: {{SMOKE_TEST_RUN}}
  lint_passed: {{LINT_PASSED}}
  typecheck_passed: {{TYPECHECK_PASSED}}
  bugs_found: {{BUGS_FOUND_COUNT}}
  bugs_fixed: {{BUGS_FIXED_COUNT}}

checkpoint_id: "{{CP_ID}}"
files_created: {{FILE_COUNT}}
lines_of_code: {{LOC}}
```
