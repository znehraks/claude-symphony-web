// Stage 09: Testing & E2E Configuration
{
  "$schema": "../../../schemas/stage.schema.json",
  "stage": {
    "id": "09-testing",
    "name": "Testing & E2E",
    "description": "Test code writing and E2E testing"
  },
  "models": {
    "primary": "codex",
    "secondary": "claudecode",
    "collaboration": "parallel"
  },
  "auto_invoke": {
    "enabled": true,
    "model": "codex",
    "trigger": "stage_start",
    "prompt_file": "prompts/unit_tests.md",
    "wrapper": "scripts/codex-wrapper.sh",
    "required": true,
    "message": "ðŸ¤– Codex auto-invoke: Starting test generation",
    "fallback": {
      "enabled": true,
      "model": "claudecode",
      "retry_count": 2,
      "retry_delay_ms": 3000,
      "timeout_ms": 60000
    }
  },
  "execution": {
    "mode": "sandbox_playwright",
    "container": false,
    "sandbox": true,
    "timeout": 7200
  },
  "mcp_servers": [
    "playwright"
  ],
  "inputs": {
    "required": [
      {
        "name": "source_code/",
        "description": "Source code to test"
      },
      {
        "name": "../08-qa/outputs/qa_report.md"
      },
      {
        "name": "../08-qa/HANDOFF.md"
      }
    ]
  },
  "outputs": {
    "required": [
      {
        "name": "tests/",
        "description": "Test code"
      },
      {
        "name": "test_report.md",
        "description": "Test results report"
      },
      {
        "name": "coverage_report.md",
        "description": "Coverage report"
      },
      {
        "name": "HANDOFF.md"
      }
    ]
  },
  "prompts": [
    {
      "name": "unit_tests",
      "file": "prompts/unit_tests.md",
      "model": "codex"
    },
    {
      "name": "integration_tests",
      "file": "prompts/integration_tests.md",
      "model": "codex"
    },
    {
      "name": "e2e_tests",
      "file": "prompts/e2e_tests.md",
      "model": "codex"
    }
  ],
  "completion": {
    "checklist": [
      "Unit tests written (coverage 80%+)",
      "Integration tests written",
      "E2E tests written",
      "All tests passing",
      "Coverage report generated"
    ],
    "validation": {
      "min_coverage": 80
    }
  },
  "transition": {
    "next_stage": "10-deployment",
    "prerequisites": [
      "08-qa"
    ],
    "handoff_required": true,
    "checkpoint_required": false
  }
}