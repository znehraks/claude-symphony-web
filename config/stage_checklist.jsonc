// claude-symphony Stage Checklist Configuration
// Defines required items for each stage completion
{
  "$schema": "https://raw.githubusercontent.com/znehraks/claude-symphony/main/schemas/stage_checklist.schema.json",
  "version": "1.0.0",
  "description": "Stage-by-stage checklist for mandatory requirements before transition",

  "global_settings": {
    "block_on_failure": true,
    "allow_force_override": true,
    "require_justification_on_override": true
  },

  "stages": {
    "01-brainstorm": {
      "description": "Brainstorming stage checklist",
      "ai_model": {
        "primary": "gemini",
        "secondary": "claudecode",
        "execution": "parallel"
      },
      "required_mcp": ["exa"],
      "optional_mcp": ["web_search"],
      "fallback_mcp": {
        "exa": ["web_search"]
      },
      "required_cli": ["/gemini"],
      "required_inputs": [],
      "required_outputs": [
        "outputs/output_gemini.md",
        "outputs/output_claudecode.md",
        "outputs/ideas.md",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/ideas.md", "HANDOFF.md"],
      "validation_rules": {
        "ideas_minimum": 10
      },
      "smoke_tests": [],
      "git_commit_required": false,
      "git_commit_format": null,
      "checkpoint_required": false,
      "checkpoint_trigger": null
    },

    "02-research": {
      "description": "Research stage checklist",
      "ai_model": {
        "primary": "claude",
        "secondary": null,
        "execution": "single"
      },
      "required_mcp": ["context7"],
      "optional_mcp": ["exa", "firecrawl"],
      "fallback_mcp": {
        "context7": ["exa", "web_search"]
      },
      "required_cli": [],
      "required_inputs": [
        "stages/01-brainstorm/outputs/ideas.md"
      ],
      "required_outputs": [
        "outputs/tech_research.md",
        "outputs/feasibility_report.md",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/tech_research.md", "HANDOFF.md"],
      "validation_rules": {
        "min_competitors_analyzed": 3
      },
      "smoke_tests": [],
      "git_commit_required": false,
      "git_commit_format": null,
      "checkpoint_required": false,
      "checkpoint_trigger": null
    },

    "03-planning": {
      "description": "Planning stage checklist",
      "ai_model": {
        "primary": "gemini",
        "secondary": "claudecode",
        "execution": "parallel"
      },
      "required_mcp": ["context7"],
      "optional_mcp": ["exa"],
      "fallback_mcp": {
        "context7": ["exa"]
      },
      "required_cli": ["/gemini", "/refine --validate"],
      "required_inputs": [
        "stages/02-research/outputs/tech_research.md"
      ],
      "required_outputs": [
        "outputs/output_gemini.md",
        "outputs/output_claudecode.md",
        "outputs/architecture.md",
        "outputs/tech_stack.md",
        "outputs/implementation.yaml",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/implementation.yaml", "outputs/architecture.md", "HANDOFF.md"],
      "validation_rules": {},
      "smoke_tests": [],
      "git_commit_required": false,
      "git_commit_format": null,
      "checkpoint_required": false,
      "checkpoint_trigger": null
    },

    "04-ui-ux": {
      "description": "UI/UX Planning stage checklist",
      "ai_model": {
        "primary": "gemini",
        "secondary": "claudecode",
        "execution": "parallel"
      },
      "required_mcp": ["stitch"],
      "optional_mcp": ["figma-dev-mode"],
      "fallback_mcp": {
        "stitch": ["figma-dev-mode", "claude_vision"]
      },
      "required_cli": ["/gemini", "/moodboard"],
      "required_inputs": [
        "stages/03-planning/outputs/architecture.md"
      ],
      "required_outputs": [
        "outputs/output_gemini.md",
        "outputs/output_claudecode.md",
        "outputs/wireframes.md",
        "outputs/design_system.md",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/wireframes.md", "HANDOFF.md"],
      "validation_rules": {
        "wireframes_minimum": 5
      },
      "smoke_tests": [],
      "git_commit_required": false,
      "git_commit_format": null,
      "checkpoint_required": false,
      "checkpoint_trigger": null
    },

    "05-task-management": {
      "description": "Task Management stage checklist",
      "ai_model": {
        "primary": "claudecode",
        "secondary": null,
        "execution": "single"
      },
      "required_mcp": ["notion"],
      "optional_mcp": [],
      "fallback_mcp": {
        "notion": ["json_file"]
      },
      "required_cli": ["/sync notion"],
      "required_inputs": [
        "stages/03-planning/outputs/architecture.md",
        "stages/04-ui-ux/outputs/wireframes.md"
      ],
      "required_outputs": [
        "outputs/tasks.md",
        "outputs/sprint_plan.md",
        "outputs/milestones.md",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/tasks.md", "outputs/sprint_plan.md", "HANDOFF.md"],
      "validation_rules": {
        "sprints_minimum": 3
      },
      "smoke_tests": [],
      "git_commit_required": false,
      "git_commit_format": null,
      "checkpoint_required": false,
      "checkpoint_trigger": null
    },

    "06-implementation": {
      "description": "Implementation stage checklist",
      "ai_model": {
        "primary": "claudecode",
        "secondary": null,
        "execution": "single"
      },
      "required_mcp": ["context7"],
      "optional_mcp": [],
      "fallback_mcp": {},
      "required_cli": ["/config order"],
      "required_inputs": [
        "stages/03-planning/outputs/implementation.yaml",
        "stages/05-task-management/outputs/tasks.md"
      ],
      "required_outputs": [
        "outputs/source_code/",
        "outputs/implementation_log.md",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/source_code/", "HANDOFF.md"],
      "validation_rules": {},
      "smoke_tests": [
        {
          "name": "dev_server",
          "command": "npm run dev",
          "timeout": 30000,
          "required": false,
          "description": "Start development server"
        },
        {
          "name": "lint",
          "command": "npm run lint",
          "timeout": 60000,
          "required": true,
          "description": "Run linter"
        },
        {
          "name": "typecheck",
          "command": "npm run typecheck",
          "timeout": 60000,
          "required": true,
          "description": "Run type checker"
        },
        {
          "name": "test_coverage",
          "command": "npm run test:coverage",
          "timeout": 120000,
          "required": true,
          "coverage_threshold": 80,
          "description": "Run tests with coverage"
        }
      ],
      "git_commit_required": true,
      "git_commit_format": "feat(impl): <description>",
      "checkpoint_required": true,
      "checkpoint_trigger": "sprint_completion"
    },

    "07-refactoring": {
      "description": "Refactoring stage checklist",
      "ai_model": {
        "primary": "codex",
        "secondary": "claudecode",
        "execution": "parallel"
      },
      "required_mcp": [],
      "optional_mcp": [],
      "fallback_mcp": {},
      "required_cli": ["/codex"],
      "required_inputs": [
        "stages/06-implementation/outputs/source_code/"
      ],
      "required_outputs": [
        "outputs/output_codex.md",
        "outputs/output_claudecode.md",
        "outputs/refactoring_report.md",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/refactoring_report.md", "HANDOFF.md"],
      "validation_rules": {},
      "regression_tests": [
        {
          "name": "test",
          "command": "npm run test",
          "timeout": 120000,
          "required": true,
          "description": "Run all tests"
        },
        {
          "name": "lint",
          "command": "npm run lint",
          "timeout": 60000,
          "required": true,
          "description": "Run linter"
        },
        {
          "name": "typecheck",
          "command": "npm run typecheck",
          "timeout": 60000,
          "required": true,
          "description": "Run type checker"
        }
      ],
      "git_commit_required": true,
      "git_commit_format": "refactor(refactor): <description>",
      "checkpoint_required": true,
      "checkpoint_trigger": "before_major_refactoring"
    },

    "08-qa": {
      "description": "QA stage checklist",
      "ai_model": {
        "primary": "claudecode",
        "secondary": null,
        "execution": "single"
      },
      "required_mcp": [],
      "optional_mcp": [],
      "fallback_mcp": {},
      "required_cli": [],
      "required_inputs": [
        "stages/07-refactoring/outputs/refactoring_report.md"
      ],
      "required_outputs": [
        "outputs/qa_report.md",
        "outputs/bug_fixes.md",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/qa_report.md", "HANDOFF.md"],
      "validation_rules": {},
      "security_checks": [
        "input_validation",
        "authentication",
        "authorization",
        "xss_prevention",
        "sql_injection_prevention",
        "sensitive_data_exposure"
      ],
      "smoke_tests": [],
      "git_commit_required": true,
      "git_commit_format": "fix(qa): <description>",
      "checkpoint_required": false,
      "checkpoint_trigger": null
    },

    "09-testing": {
      "description": "Testing & E2E stage checklist",
      "ai_model": {
        "primary": "codex",
        "secondary": "claudecode",
        "execution": "parallel"
      },
      "required_mcp": ["playwright"],
      "optional_mcp": ["chrome-devtools"],
      "fallback_mcp": {
        "playwright": ["chrome-devtools"]
      },
      "required_cli": ["/codex"],
      "required_inputs": [
        "stages/08-qa/outputs/qa_report.md"
      ],
      "required_outputs": [
        "outputs/output_codex.md",
        "outputs/output_claudecode.md",
        "outputs/tests/",
        "outputs/test_report.md",
        "outputs/coverage_report.md",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/tests/", "outputs/coverage_report.md", "HANDOFF.md"],
      "validation_rules": {},
      "coverage_requirements": {
        "statements": 80,
        "branches": 75,
        "functions": 80,
        "lines": 80
      },
      "test_commands": [
        {
          "name": "unit_tests",
          "command": "npm run test",
          "timeout": 120000,
          "required": true,
          "description": "Run unit tests"
        },
        {
          "name": "coverage",
          "command": "npm run test:coverage",
          "timeout": 120000,
          "required": true,
          "description": "Run tests with coverage"
        },
        {
          "name": "e2e",
          "command": "npm run test:e2e",
          "timeout": 300000,
          "required": true,
          "description": "Run E2E tests"
        }
      ],
      "git_commit_required": true,
      "git_commit_format": "test(test): <description>",
      "checkpoint_required": false,
      "checkpoint_trigger": null
    },

    "10-deployment": {
      "description": "CI/CD & Deployment stage checklist",
      "ai_model": {
        "primary": "claudecode",
        "secondary": null,
        "execution": "single"
      },
      "required_mcp": [],
      "optional_mcp": [],
      "fallback_mcp": {},
      "required_cli": [],
      "required_inputs": [
        "stages/09-testing/outputs/test_report.md"
      ],
      "required_outputs": [
        "outputs/.github/workflows/",
        "outputs/deployment_config/",
        "outputs/deployment_log.md",
        "HANDOFF.md"
      ],
      "critical_outputs": ["outputs/.github/workflows/", "HANDOFF.md"],
      "validation_rules": {},
      "deployment_checks": [
        {
          "name": "ci_workflow",
          "description": "CI workflow file exists"
        },
        {
          "name": "cd_workflow",
          "description": "CD workflow file exists"
        },
        {
          "name": "env_config",
          "description": "Environment configuration exists"
        }
      ],
      "git_commit_required": true,
      "git_commit_format": "ci(deploy): <description>",
      "checkpoint_required": false,
      "checkpoint_trigger": null
    }
  },

  "checklist_categories": {
    "input": {
      "description": "Required files from previous stages",
      "icon": "INPUT",
      "blocking": true
    },
    "mcp": {
      "description": "Required MCP servers",
      "icon": "MCP",
      "blocking": false
    },
    "cli": {
      "description": "Required CLI calls (output files exist)",
      "icon": "CLI",
      "blocking": true
    },
    "output": {
      "description": "Required deliverables",
      "icon": "OUTPUT",
      "blocking": true
    },
    "test": {
      "description": "Smoke/regression tests",
      "icon": "TEST",
      "blocking": true
    },
    "git": {
      "description": "Git commit status",
      "icon": "GIT",
      "blocking": true
    },
    "checkpoint": {
      "description": "Checkpoint requirements",
      "icon": "CHECKPOINT",
      "blocking": true
    }
  },

  "parallel_execution_stages": [
    "01-brainstorm",
    "03-planning",
    "04-ui-ux",
    "07-refactoring",
    "09-testing"
  ],

  "cli_output_mapping": {
    "/gemini": "outputs/output_gemini.md",
    "/codex": "outputs/output_codex.md",
    "/moodboard": "outputs/moodboard_result.md",
    "/refine --validate": "outputs/requirements_validated.md"
  },

  "frequently_missed": [
    {
      "rank": 1,
      "issue": "Primary AI CLI not called in parallel execution stages",
      "affected_stages": ["01-brainstorm", "03-planning", "04-ui-ux", "07-refactoring", "09-testing"],
      "solution": "Run /gemini or /codex command first"
    },
    {
      "rank": 2,
      "issue": "implementation.yaml not generated",
      "affected_stages": ["03-planning"],
      "solution": "Generate implementation.yaml in Stage 03 outputs"
    },
    {
      "rank": 3,
      "issue": "Smoke tests not executed",
      "affected_stages": ["06-implementation"],
      "solution": "Run npm run lint, npm run typecheck, npm run test:coverage"
    },
    {
      "rank": 4,
      "issue": "Git commits missing",
      "affected_stages": ["06-implementation", "07-refactoring", "08-qa", "09-testing", "10-deployment"],
      "solution": "Commit changes with proper format before transition"
    },
    {
      "rank": 5,
      "issue": "Checkpoints not created",
      "affected_stages": ["06-implementation", "07-refactoring"],
      "solution": "Run /checkpoint command"
    },
    {
      "rank": 6,
      "issue": "HANDOFF.md not generated",
      "affected_stages": ["all"],
      "solution": "Run /handoff command before transition"
    },
    {
      "rank": 7,
      "issue": "Test coverage below 80%",
      "affected_stages": ["06-implementation", "09-testing"],
      "solution": "Add more tests to increase coverage"
    },
    {
      "rank": 8,
      "issue": "Security checks not performed",
      "affected_stages": ["08-qa"],
      "solution": "Run OWASP Top 10 security checks"
    },
    {
      "rank": 9,
      "issue": "Test results not recorded in HANDOFF",
      "affected_stages": ["06-implementation", "07-refactoring", "08-qa", "09-testing"],
      "solution": "Include test results in HANDOFF.md"
    },
    {
      "rank": 10,
      "issue": "Codex fallback not recorded",
      "affected_stages": ["07-refactoring", "09-testing"],
      "solution": "Document in HANDOFF.md if Codex was unavailable"
    }
  ]
}
