// claude-symphony Requirements Refinement Configuration
{
  "requirements_refinement": {
    "enabled": true,
    "description": "Systematic requirements breakdown and refinement loop",
    "max_iterations": 5,
    "granularity_levels": [
      {
        "level": "epic",
        "order": 1,
        "name": "Epic",
        "description": "Large-scale feature or theme",
        "examples": [
          "User Authentication System",
          "E-commerce Shopping Cart",
          "Real-time Notifications",
          "Admin Dashboard"
        ],
        "characteristics": [
          "Spans multiple sprints",
          "Contains 3-10 features",
          "Business-level goal"
        ],
        "typical_duration": "2-8 weeks",
        "max_hours": null
      },
      {
        "level": "feature",
        "order": 2,
        "name": "Feature",
        "description": "Individual user-facing capability",
        "breakdown_from": "epic",
        "examples": [
          "Google OAuth Login",
          "Product Search with Filters",
          "Push Notification Delivery",
          "User Management Table"
        ],
        "characteristics": [
          "Deliverable in 1 sprint",
          "Contains 2-5 tasks",
          "User story level"
        ],
        "typical_duration": "3-5 days",
        "max_hours": 40
      },
      {
        "level": "task",
        "order": 3,
        "name": "Task",
        "description": "Technical implementation unit",
        "breakdown_from": "feature",
        "examples": [
          "Implement OAuth callback handler",
          "Create search API endpoint",
          "Build notification service",
          "Design user table component"
        ],
        "characteristics": [
          "Single responsibility",
          "Clear acceptance criteria",
          "Testable"
        ],
        "typical_duration": "4-8 hours",
        "max_hours": 8
      },
      {
        "level": "subtask",
        "order": 4,
        "name": "Subtask",
        "description": "Atomic implementation step",
        "breakdown_from": "task",
        "examples": [
          "Add Google Client ID to environment",
          "Write Zod schema for search params",
          "Configure FCM credentials",
          "Add pagination controls"
        ],
        "characteristics": [
          "Single commit scope",
          "No ambiguity",
          "Directly actionable"
        ],
        "typical_duration": "30min - 2 hours",
        "max_hours": 2
      }
    ],
    "triggers": {
      "scope_unclear": {
        "enabled": true,
        "description": "Detect vague or ambiguous requirements",
        "patterns": [
          "should be able to",
          "might need",
          "etc.",
          "and more",
          "various",
          "TBD",
          "to be determined",
          "somehow",
          "maybe"
        ],
        "action": "suggest_refinement",
        "message": "This requirement seems vague. Consider using /refine to clarify."
      },
      "size_large": {
        "enabled": true,
        "description": "Detect requirements that are too large",
        "condition": "estimated_hours > 40",
        "action": "require_breakdown",
        "message": "This requirement is too large (>40 hours). Breakdown required."
      },
      "missing_acceptance": {
        "enabled": true,
        "description": "Detect requirements without clear acceptance criteria",
        "patterns": [
          "No acceptance criteria defined",
          "AC: TBD"
        ],
        "action": "suggest_refinement",
        "message": "Missing acceptance criteria. Consider using /refine to define."
      },
      "dependency_unclear": {
        "enabled": true,
        "description": "Detect unclear dependencies",
        "patterns": [
          "depends on",
          "after X is done",
          "when available"
        ],
        "action": "flag_for_review",
        "message": "Dependency detected but not clearly defined."
      }
    },
    "workflow": {
      "stages": [
        {
          "id": "identify",
          "name": "Identify",
          "description": "Identify requirements needing refinement",
          "actions": [
            "scan_for_trigger_patterns",
            "check_size_thresholds",
            "flag_candidates"
          ],
          "outputs": [
            "refinement_candidates.md"
          ]
        },
        {
          "id": "analyze",
          "name": "Analyze",
          "description": "Deep analysis of requirement",
          "actions": [
            "determine_current_level",
            "identify_ambiguities",
            "map_dependencies",
            "estimate_effort"
          ],
          "prompts": [
            "What is the user trying to accomplish?",
            "What are the edge cases?",
            "What are the technical constraints?",
            "What are the acceptance criteria?"
          ]
        },
        {
          "id": "breakdown",
          "name": "Breakdown",
          "description": "Break down into smaller units",
          "actions": [
            "apply_granularity_rules",
            "create_sub_requirements",
            "assign_estimates",
            "define_acceptance_criteria"
          ],
          "rules": [
            "Each level should have 2-5 children",
            "No task should exceed max_hours",
            "Each item needs clear acceptance criteria"
          ]
        },
        {
          "id": "validate",
          "name": "Validate",
          "description": "Validate refined requirements",
          "checks": [
            "All items have acceptance criteria",
            "Estimates are within thresholds",
            "Dependencies are mapped",
            "No circular dependencies",
            "INVEST criteria met for tasks"
          ],
          "actions": [
            "run_validation_checks",
            "flag_issues",
            "suggest_fixes"
          ]
        },
        {
          "id": "document",
          "name": "Document",
          "description": "Update documentation with refined requirements",
          "actions": [
            "update_requirements_doc",
            "update_task_list",
            "record_refinement_history"
          ],
          "outputs": [
            "refined_requirements.md",
            "updated tasks.md"
          ]
        }
      ]
    },
    "templates": {
      "epic_template": "## Epic: {{NAME}}\n\n### Description\n{{DESCRIPTION}}\n\n### Business Value\n{{BUSINESS_VALUE}}\n\n### Features\n{{#each FEATURES}}\n- [ ] {{this.name}}\n{{/each}}\n\n### Success Metrics\n{{SUCCESS_METRICS}}\n",
      "feature_template": "## Feature: {{NAME}}\n**Parent Epic:** {{EPIC_NAME}}\n\n### User Story\nAs a {{USER_TYPE}}, I want to {{ACTION}} so that {{BENEFIT}}.\n\n### Acceptance Criteria\n{{#each ACCEPTANCE_CRITERIA}}\n- [ ] {{this}}\n{{/each}}\n\n### Tasks\n{{#each TASKS}}\n- [ ] {{this.name}} ({{this.estimate}})\n{{/each}}\n\n### Estimate\n{{ESTIMATE_HOURS}} hours\n",
      "task_template": "## Task: {{NAME}}\n**Parent Feature:** {{FEATURE_NAME}}\n\n### Description\n{{DESCRIPTION}}\n\n### Acceptance Criteria\n{{#each ACCEPTANCE_CRITERIA}}\n- [ ] {{this}}\n{{/each}}\n\n### Subtasks\n{{#each SUBTASKS}}\n- [ ] {{this.name}}\n{{/each}}\n\n### Estimate\n{{ESTIMATE_HOURS}} hours\n\n### Technical Notes\n{{TECHNICAL_NOTES}}\n",
      "subtask_template": "- [ ] **{{NAME}}** ({{ESTIMATE}})\n  {{DESCRIPTION}}\n"
    },
    "invest_criteria": {
      "enabled": true,
      "description": "Validate tasks against INVEST criteria",
      "criteria": [
        {
          "id": "independent",
          "name": "Independent",
          "description": "Can be developed without other items",
          "check": "dependencies.length == 0 || dependencies_resolved"
        },
        {
          "id": "negotiable",
          "name": "Negotiable",
          "description": "Details can be discussed",
          "check": "has_alternatives || is_flexible"
        },
        {
          "id": "valuable",
          "name": "Valuable",
          "description": "Delivers value to user",
          "check": "has_user_benefit"
        },
        {
          "id": "estimable",
          "name": "Estimable",
          "description": "Can be estimated",
          "check": "estimate_hours > 0"
        },
        {
          "id": "small",
          "name": "Small",
          "description": "Small enough to complete quickly",
          "check": "estimate_hours <= 8"
        },
        {
          "id": "testable",
          "name": "Testable",
          "description": "Has clear acceptance criteria",
          "check": "acceptance_criteria.length > 0"
        }
      ]
    },
    "commands": {
      "start": "/refine",
      "refine_specific": "/refine <requirement>",
      "list": "/refine --list",
      "validate": "/refine --validate",
      "history": "/refine --history"
    },
    "integration": {
      "stage_01_brainstorm": {
        "auto_suggest": true,
        "when": "requirements_captured",
        "message": "Use /refine to break down captured requirements"
      },
      "stage_03_planning": {
        "auto_check": true,
        "before_completion": true,
        "message": "Validate all requirements are properly refined before proceeding"
      },
      "stage_05_task_management": {
        "auto_apply": true,
        "description": "Apply refinement hierarchy to task organization"
      }
    },
    "outputs": {
      "refined_requirements": {
        "location": "stages/03-planning/outputs/refined_requirements.md",
        "format": "markdown"
      },
      "refinement_log": {
        "location": "state/refinement_log.json",
        "format": "json"
      }
    }
  }
}